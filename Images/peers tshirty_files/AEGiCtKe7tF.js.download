;/*FB_PKG_DELIM*/

__d("MAWCreateOptimisticSecureMessageWithAttachmentIDB",["I64","MAWBuildNewMsgPayload","MAWDbMsg","MAWIDBOptimisticMessageUtils","MAWOptimisticMessageUtils","MAWSendFileMsgTypes","QPLUserFlow","asyncToGeneratorRuntime","nullthrows","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var e=b.attachmentType,f=b.ephemeralSettings,g=b.initiatingSource,i=b.instanceKey,j=b.mawThreadResult,k=b.mediaGroupMetadataMap,l=b.messageExternalId,m=b.offlineAttachmentId,n=b.onOfflineMsgId,o=b.optimisticMediaAttachment,p=b.reply,q=b.senderId,r=b.threadKey;b=b.threadSource;n(l);n=d("MAWOptimisticMessageUtils").getOptimisticMessageTimestamp();var s=(h||(h=d("I64"))).of_float(n);p=p!=null?yield d("MAWIDBOptimisticMessageUtils").getQuoteByMsgId(c("nullthrows")(d("MAWDbMsg").toMsgId(p.messageId)),j.jid):{quote:void 0,quoteInfo:void 0};var t=p.quote;p=p.quoteInfo;var u=d("MAWOptimisticMessageUtils").buildMAWOptimisticBaseMsg({ephemeralSettings:f,externalId:l,threadJid:j.jid,ts:n});k=k==null?void 0:k.get(d("MAWSendFileMsgTypes").toOfflineAttachmentIDFromString(m));g=babelHelpers["extends"]({},d("MAWOptimisticMessageUtils").buildMAWBaseSendMsgArgs({content:"",initiatingSource:g||void 0,isFirstMsg:j.created,optimisticMsg:{msgId:l,ts:n},quote:t,threadSource:b}),{ephemeralSetting:f||void 0,mediaGroupMetadata:k,offlineAttachmentId:m});t=d("MAWBuildNewMsgPayload").buildNewMsg(d("MAWOptimisticMessageUtils").lsAttachmentTypeToMsgType(e),u,g,p);b=(yield d("MAWIDBOptimisticMessageUtils").writeMsgToDb(t,j.jid));f=d("MAWOptimisticMessageUtils").buildOptimisticAttachment({attachmentType:e,messageExternalId:b,offlineAttachmentId:m,optimisticMediaAttachment:o,senderId:q,threadKey:r,timestampMsI64:s});yield a.attachments.add(f);c("QPLUserFlow").addPoint(c("qpl")._(25313175,"1551"),"after_create_optimistic_message",{instanceKey:i});c("QPLUserFlow").addPoint(c("qpl")._(25313175,"1551"),"optimistic_bump_thread_start",{instanceKey:i});yield d("MAWOptimisticMessageUtils").optimisticBumpThreadMedia(a,{optimisticMediaAttachment:o,senderId:q,threadKey:r,timestampMsI64:s});c("QPLUserFlow").addPoint(c("qpl")._(25313175,"1551"),"optimistic_bump_thread_end",{instanceKey:i});return{messageExternalId:l,offlineAttachmentId:d("MAWSendFileMsgTypes").toOfflineAttachmentIDFromString(m),offlineMsgTimestamp:n}});return i.apply(this,arguments)}g.createIdbOptimisticMessageWithAttachment=a}),98);
__d("MAWCreateOptimisticsSecureMessageWithXMAAttachmentIDB",["I64","LSIntEnum","MAWAdminMsg","MAWBuildNewMsgPayload","MAWBumpThread","MAWDbMsg","MAWGetEphemeralSettings","MAWIDBOptimisticMessageUtils","MAWLocalizationType","MAWMsgType","MAWOptimisticMessageUtils","MAWSendFileMsgTypes","MAWVault","MessagingAttachmentType","QPLUserFlow","asyncToGeneratorRuntime","nullthrows","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function a(a,b,c,d,e,f,g,h,i,k,l,m,n,o,p,q,r){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e,f,g,j,k,l,m,n,o,p,q,r,s,t,u){var v=(yield d("MAWGetEphemeralSettings").getEphemeralSetting(l.jid,f));m(n);m=d("MAWOptimisticMessageUtils").getOptimisticMessageTimestamp();var w=(h||(h=d("I64"))).of_float(m);e=e!=null?yield d("MAWIDBOptimisticMessageUtils").getQuoteByMsgId(c("nullthrows")(d("MAWDbMsg").toMsgId(e.messageId)),l.jid):{quote:void 0,quoteInfo:void 0};var x=e.quote;e=e.quoteInfo;var y=d("MAWOptimisticMessageUtils").buildMAWOptimisticBaseMsg({ephemeralSettings:v,externalId:n,threadJid:l.jid,ts:m});r=babelHelpers["extends"]({},d("MAWOptimisticMessageUtils").buildMAWBaseSendMsgArgs({content:q,initiatingSource:r||void 0,isFirstMsg:l.created,mentionedJids:t,optimisticMsg:{msgId:n,ts:m},quote:x,threadSource:s}),{ephemeralSetting:v||void 0,offlineAttachmentId:g,xmaMessageType:u});t=d("MAWBuildNewMsgPayload").buildNewMsg(d("MAWMsgType").MSG_TYPE.XMA,y,r,e);x=(yield d("MAWIDBOptimisticMessageUtils").writeMsgToDb(t,l.jid));s=d("MAWOptimisticMessageUtils").buildOptimisticAttachment({attachmentType:(i||(i=d("LSIntEnum"))).ofNumber(c("MessagingAttachmentType").XMA),messageExternalId:x,offlineAttachmentId:g,optimisticMediaAttachment:j,senderId:b,subtitleText:p,threadKey:f,timestampMsI64:w,titleText:o});yield a.attachments.add(s);c("QPLUserFlow").addPoint(c("qpl")._(25313175,"1551"),"after_create_optimistic_message",{instanceKey:k});c("QPLUserFlow").addPoint(c("qpl")._(25313175,"1551"),"optimistic_bump_thread_start",{instanceKey:k});yield d("MAWBumpThread").threadMutation_DEPRECATED({description:"MAWCreateOptimisticsSecureMessageWithXMAAttachmentIDB",lastActivityTs:w,lastReadTs:w,snippet:d("MAWAdminMsg").buildLocalizedString([d("MAWVault").unvault(q)],[],d("MAWLocalizationType").CURRENT_USER_SEND_TEXT),snippetSenderContactId:b,threadKey:f,txn:a});c("QPLUserFlow").addPoint(c("qpl")._(25313175,"1551"),"optimistic_bump_thread_end",{instanceKey:k});return{messageExternalId:n,offlineAttachmentId:d("MAWSendFileMsgTypes").toOfflineAttachmentIDFromString(g),offlineMsgTimestamp:m}});return j.apply(this,arguments)}g["default"]=a}),98);
__d("MAWMediaUIConverter",["MAWBridgeNewMediaHandler","MAWBridgeTypesCreators","MAWRavenUtils","WAJids","WATimeUtils","gkx"],(function(a,b,c,d,e,f,g){"use strict";var h=d("WAJids").unsafeCoerceToChatJid("placeholder");function i(a){return d("MAWBridgeTypesCreators").createBridgeMedia(a)}function j(a,b,e){return i({chatJid:h,filteredMsgIds:[e.msgId],hasMediaForUI:b,media:a,ravenSettings:e.ravenEphemeralType!=null&&e.ravenEphemeralMediaState!=null?d("MAWRavenUtils").deriveRavenSettings(e.ravenEphemeralType,e.ravenEphemeralMediaState):null,sortOrderMs:c("gkx")("5319")?d("WATimeUtils").castToMillisTime(e.sortOrderMs!=null?e.sortOrderMs:e.ts*1e3):null})}function k(a,b,c){var e=b.mediaId,f=b.offlineAttachmentId,g=b.plaintextHash;e=d("MAWBridgeNewMediaHandler").getAttachmentID(e,g);return d("MAWBridgeNewMediaHandler").getAttachmentFromBridgeMedia(null,b,c.msgId,e,(g=f)!=null?g:e,a)}function a(a,b,c,d){if(d==null)return;d=j(d,b,c);if(d==null)return;return k(a,d,c)}g.mawToLS=a}),98);
__d("MAWMessageAttachmentCache",["CometLruCache","MAWAttachmentSizeUtils","justknobx"],(function(a,b,c,d,e,f,g){"use strict";f=c("justknobx")._("3443");var h=d("CometLruCache").create(f);function a(a){a=h.get(a.messageId);if(a==null)return null;var b=d("MAWAttachmentSizeUtils").getSizeFromAttachment(a),c=b.height;b=b.width;return{size:{height:c,width:b},type:a.attachmentType}}function b(a){return h.get(a.messageId)}function e(a,b){h.set(a,b)}g.getAttachmentSizeForMessage=a;g.getAttachmentForMessage=b;g.setAttachmentForMessage=e}),98);
__d("MAWMessageUIConverter",["I64","MAWAdminMsgCTA","MAWBridgeMsg","MAWBridgeMsgCountdown","MAWBridgeNewMsgHandler","MAWMsgReplySnippet"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(a,b){return d("MAWBridgeMsg").createBridgeMsg(a,void 0,b,void 0)}function j(a){return{ctaType:d("MAWAdminMsgCTA").getCtaTypeByAdminType(a.adminType),title:d("MAWAdminMsgCTA").getAdminMsgCTAContentByAdminType(a.adminType).title}}function a(a,b,c){c=i(b,c);a=d("MAWBridgeNewMsgHandler").composeMessage(a,c,j(c),d("MAWMsgReplySnippet").getReplySnippet(c));if(b.ephemeralCounterStarted===!0){c=d("MAWBridgeMsgCountdown").createBridgeMsgsStartCountdown([b]);b=c.msgs.length===1?c.msgs[0]:void 0;if(b!=null)return babelHelpers["extends"]({},a,{ephemeralExpirationTs:(h||(h=d("I64"))).of_float(b.countdownTs)})}return a}g.mawToLS=a}),98);
__d("MAWMessagesLiveQuery",["I64","MAWDbMediaTxns","MAWDexieTable","MAWLiveQuery","MAWLoadMsgsDedupper","MAWLoadReplyMediaTxns","MAWMediaUIConverter","MAWMessageAttachmentCache","MAWMessageUIConverter","MAWReceiverFetchMediaUIConvertor","MAWXMAUtils","WATimeUtils","gkx","justknobx"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(a,b,c,d,e,f){return a.openReadonlyTransaction(["messages","media","chunk","xma","receiverFetchInfo"],function(a){return j(a,b,c,d,e,f)})}function j(a,b,c,e,f,g){return m({messages:a.messages},b,{gte:(b=e.gte)!=null?b:Number.MIN_VALUE,lte:(b=e.lte)!=null?b:Number.MAX_VALUE},f,g).then(function(b){return d("MAWDexieTable").dexieAll(b.map(function(b){return k(a,b)})).then(function(a){var e=[];b.forEach(function(b,f){f=a[f];var g=f.media,h=f.receiverFetchInfo;f=f.replyAttachment;e.push({msg:b,replyAttachment:f});f=d("MAWMediaUIConverter").mawToLS(c,!0,b,g);g=h==null?null:d("MAWReceiverFetchMediaUIConvertor").mawToLS(b,h,c);g=(h=g)!=null?h:f;g!=null&&d("MAWMessageAttachmentCache").setAttachmentForMessage(b.msgId,g)});return e})})}function k(a,b){return d("MAWDexieTable").dexieAll([d("MAWLoadReplyMediaTxns").getReplyMediaForMsgQuote(a,b,!0),d("MAWDbMediaTxns").maybeGetMediaFromMediaId(a,b.mediaId),l(a,b)]).then(function(a){var b=a[0],c=a[1];a=a[2];return{media:c,receiverFetchInfo:a,replyAttachment:b}})}function l(a,b){b=b==null?void 0:b.receiverFetchId;return b==null?d("MAWDexieTable").dexieResolve(null):a.receiverFetchInfo.get(b)}function m(a,b,e,f,g){var h=c("MAWLoadMsgsDedupper")();a=a.messages.where(["threadJid","sortOrderMs"]).between([b,e.gte],[b,e.lte],!0,!0);if(c("gkx")("1803"))return a.toArray().then(function(a){a=(g==="asc"?a:a.reverse()).filter(function(a){return!d("MAWXMAUtils").isXMAStoryReply(a.xmaMessageType)&&(a.messageExpirationTs==null||a.messageExpirationTs>d("WATimeUtils").unixTime())&&a.ephemeralMsgDisappeared!==!0}).filter(h).filter(function(a){return c("justknobx")._("3227")?a.source!=="media_restore":a!=null});return a.slice(0,f)});else return(g==="asc"?a:a.reverse()).filter(function(a){return!d("MAWXMAUtils").isXMAStoryReply(a.xmaMessageType)&&(a.messageExpirationTs==null||a.messageExpirationTs>d("WATimeUtils").unixTime())&&a.ephemeralMsgDisappeared!==!0}).filter(h).filter(function(a){return c("justknobx")._("3227")?a.source!=="media_restore":a!=null}).limit(f).toArray()}function n(a,b){b=d("MAWMessageUIConverter").mawToLS(b,a.msg,a.replyAttachment);return[[b.primarySortKey,b.messageId],b]}function a(a,b,c,e,g,j,k){return d("MAWLiveQuery").createMawObservable(b,function(a){return i(a,e,c,{gte:(h||(h=d("I64"))).to_float(j.gte[0]),lte:h.to_float(j.lte[0])},k,g)},function(a){return a.map(function(a){return n(a,c)})},f.id+":246")}g.getMessagesForThread=m;g.MAWMessagesLiveQuery=a}),98);
__d("MAWReactionUIConverter",["MAWBridgeReactionUpsertHandler","MAWBridgeTypesCreators"],(function(a,b,c,d,e,f,g){"use strict";function h(a){var b=a.author,c=a.reaction,e=a.reactToMsgId,f=a.threadJid;a=a.ts;if(e==null||c==null)return;return d("MAWBridgeTypesCreators").createBridgeUpsertReaction({author:b,chatJid:f,reaction:c||"",reactToMsgId:e,ts:a})}function i(a,b){var c=a.actorId,e=a.messageId,f=a.reaction;a=a.ts;return d("MAWBridgeReactionUpsertHandler").composeReaction(c,b,e,a,f)}function a(a,b){a=h(a);if(a==null)return;return i(a,b)}g.mawToLS=a}),98);
__d("MWPOptimisticMessageObservable",["I64","LSAuthorityLevel","LSIntEnum","ReQL","ReQLObservable"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function a(a,b){var e=d("ReQL").fromTableAscending(a.tables.messages.index("messageDisplayOrderAuthority")).bounds({gte:[b,(h||(h=d("LSIntEnum"))).ofNumber(c("LSAuthorityLevel").OPTIMISTIC),(i||(i=d("I64"))).zero],lt:[b,h.ofNumber(c("LSAuthorityLevel").OPTIMISTIC),i.max_int]});return d("ReQLObservable").create(a,function(){return e})}g["default"]=a}),98);
__d("useSecureAttachmentDefaultPlaceholderSize",["I64","LSIntEnum","MWPAudioPlayerUtils","react-compiler-runtime"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function a(a){var b=d("react-compiler-runtime").c(8);if(b[0]!==a.ephemeralDurationInSec){var c;c=(h||(h=d("I64"))).gt((c=a.ephemeralDurationInSec)!=null?c:(h||(h=d("I64"))).zero,h.zero);b[0]=a.ephemeralDurationInSec;b[1]=c}else c=b[1];c=c;c=d("MWPAudioPlayerUtils").useCalculatePlayerWidth(void 0,c);var e=d("MWPAudioPlayerUtils").useCalculatePlayerHeight(d("MWPAudioPlayerUtils").UseCase.PLAYER);if((h||(h=d("I64"))).equal(a.displayedContentTypes,(i||(i=d("LSIntEnum"))).ofNumber(4))){var f;b[2]!==e||b[3]!==c?(f={height:e,width:c},b[2]=e,b[3]=c,b[4]=f):f=b[4];return f}if((h||(h=d("I64"))).equal(a.displayedContentTypes,(i||(i=d("LSIntEnum"))).ofNumber(64))){b[5]===Symbol["for"]("react.memo_cache_sentinel")?(e={height:60,width:250},b[5]=e):e=b[5];return e}if((h||(h=d("I64"))).equal(a.displayedContentTypes,(i||(i=d("LSIntEnum"))).ofNumber(4096))||(h||(h=d("I64"))).equal(a.displayedContentTypes,(i||(i=d("LSIntEnum"))).ofNumber(134217728))){b[6]===Symbol["for"]("react.memo_cache_sentinel")?(c={height:128,width:128},b[6]=c):c=b[6];return c}b[7]===Symbol["for"]("react.memo_cache_sentinel")?(f={height:200,width:480},b[7]=f):f=b[7];return f}g["default"]=a}),98);
__d("MWV2AttachmentLoadingPlaceholderForSeparateRead.react",["MAWAttachmentSizeUtils","MAWMessageAttachmentCache","MWLSThreadDisplayContext","MWV2AttachmentLoadingPlaceholder.react","react","react-compiler-runtime","useSecureAttachmentDefaultPlaceholderSize"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||d("react");function a(a){var b=d("react-compiler-runtime").c(13),e=a.connectBottom,f=a.connectTop,g=a.mediaRenderQpl,h=a.message;a=a.outgoing;var j=c("useSecureAttachmentDefaultPlaceholderSize")(h),k=j.height;j=j.width;var l=d("MWLSThreadDisplayContext").useMWLSThreadDisplayContext(),m;if(b[0]!==l||b[1]!==h){var n=d("MAWMessageAttachmentCache").getAttachmentSizeForMessage(h);m=n==null?void 0:n.size;n=n==null?{maxHeight:void 0,maxWidth:void 0}:d("MAWAttachmentSizeUtils").getMaxSize(n,l);b[0]=l;b[1]=h;b[2]=m;b[3]=n}else m=b[2],n=b[3];l=n;h=l.maxHeight;n=l.maxWidth;l=(l=(l=m)==null?void 0:l.height)!=null?l:k;k=(m=(k=m)==null?void 0:k.width)!=null?m:j;b[4]!==e||b[5]!==f||b[6]!==h||b[7]!==n||b[8]!==g||b[9]!==a||b[10]!==l||b[11]!==k?(m=i.jsx(c("MWV2AttachmentLoadingPlaceholder.react"),{connectBottom:e,connectTop:f,descriptionForLogging:"MAWSecureAttachment.react.separate_read",hasAppAttribution:!1,height:l,maxHeight:h,maxWidth:n,mediaRenderQpl:g,outgoing:a,width:k}),b[4]=e,b[5]=f,b[6]=h,b[7]=n,b[8]=g,b[9]=a,b[10]=l,b[11]=k,b[12]=m):m=b[12];return m}g["default"]=a}),98);
__d("useMAWCreateOptimisticSecureMessageInIDB",["FBLogger","I64","MAWBuildNewMsgPayload","MAWDbMsg","MAWIDBOptimisticMessageUtils","MAWMsgType","MAWOptimisticMessageUtils","MWPActor.react","Promise","QPLUserFlow","asyncToGeneratorRuntime","clearTimeout","nullthrows","qpl","react","react-compiler-runtime","setTimeout","useAsyncReStore","useLSMessagingInitiatingSourceNumber","useMWLSDefaultThreadSource"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;(i||d("react")).useCallback;var k=1e3;function a(){var a=d("react-compiler-runtime").c(5),e=d("MWPActor.react").useActor(),g=c("useAsyncReStore")(),i=c("useLSMessagingInitiatingSourceNumber")(),l=c("useMWLSDefaultThreadSource")(),m;a[0]!==g||a[1]!==l||a[2]!==i||a[3]!==e?(m=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,m,n,o,p,q,r,s,t,u){c("QPLUserFlow").addPoint(c("qpl")._(25313175,"1551"),"before_create_optimistic_message",{instanceKey:q});var v=d("MAWOptimisticMessageUtils").getOptimisticMessageTimestamp(),w=(j||(j=d("I64"))).of_float(v);a=a!=null?yield d("MAWIDBOptimisticMessageUtils").getQuoteByMsgId(c("nullthrows")(d("MAWDbMsg").toMsgId(a.messageId)),o.jid):{quote:void 0,quoteInfo:void 0};var x=a.quote;a=a.quoteInfo;var y=d("MAWOptimisticMessageUtils").getSpecialTextSize(p);u=babelHelpers["extends"]({},d("MAWOptimisticMessageUtils").buildMAWOptimisticBaseMsg({ephemeralSettings:u,externalId:t,threadJid:o.jid,ts:v}),{specialTextSize:y});x=babelHelpers["extends"]({},d("MAWOptimisticMessageUtils").buildMAWBaseSendMsgArgs({content:m,initiatingSource:i,isFirstMsg:o.created,mentionedJids:r,optimisticMsg:{msgId:t,ts:v},quote:x,threadSource:l(n)}),{specialTextSize:y});y=d("MAWBuildNewMsgPayload").buildNewMsg(d("MAWMsgType").MSG_TYPE.TEXT,u,x,a);var z;u=new(h||(h=b("Promise")))(function(a){z=c("setTimeout")(function(){c("FBLogger")("messenger_e2ee_web").mustfix("Timeout create optimistic message in MAWDB"),a()},k)});yield h.race([u,d("MAWIDBOptimisticMessageUtils").writeMsgToDb(y,o.jid)]);c("clearTimeout")(z);s(t);c("QPLUserFlow").addPoint(c("qpl")._(25313175,"1551"),"after_create_optimistic_message",{instanceKey:q});c("QPLUserFlow").addPoint(c("qpl")._(25313175,"1551"),"optimistic_bump_thread_start",{instanceKey:q});yield (yield g).runInTransaction(function(a){return d("MAWOptimisticMessageUtils").optimisticBumpThread(a,{hotEmojiSize:p,mentionedJids:r,messageText:m,senderId:e,threadKey:n,ts:w})},"readwrite","ui",void 0,f.id+":161");c("QPLUserFlow").addPoint(c("qpl")._(25313175,"1551"),"optimistic_bump_thread_end",{instanceKey:q});return{messageExternalId:t,offlineMsgTimestamp:v}});return function(b,c,d,e,f,g,h,i,j,k){return a.apply(this,arguments)}}(),a[0]=g,a[1]=l,a[2]=i,a[3]=e,a[4]=m):m=a[4];return m}g["default"]=a}),98);
__d("useMAWSelectedMessage",["MAWDbMsg","MAWLiveQuery","MAWMessageUIConverter","react","react-compiler-runtime","relay-runtime/network/RelayObservable","useMawDbInUI","useObservable"],(function(a,b,c,d,e,f,g){"use strict";var h;(h||d("react")).useMemo;function a(a,b,e){var g=d("react-compiler-runtime").c(8),h=c("useMawDbInUI")(),i;bb0:{if(a==null){var j;g[0]===Symbol["for"]("react.memo_cache_sentinel")?(j=c("relay-runtime/network/RelayObservable").from(),g[0]=j):j=g[0];i=j;break bb0}if(g[1]!==e||g[2]!==h||g[3]!==a||g[4]!==b){var k=d("MAWDbMsg").toMsgId(a);if(k==null){g[7]===Symbol["for"]("react.memo_cache_sentinel")?(j=c("relay-runtime/network/RelayObservable").from(),g[7]=j):j=g[7];i=j;break bb0}j=d("MAWLiveQuery").maybeCreate(e,function(){return d("MAWLiveQuery").createMawObservable(h,function(a){return a.openReadonlyTransaction(["messages"],function(a){return a.messages.where("msgId").equals(k).first()})},function(a){return a!=null?d("MAWMessageUIConverter").mawToLS(b,a,void 0):null},f.id+":43")});g[1]=e;g[2]=h;g[3]=a;g[4]=b;g[5]=j;g[6]=i}else j=g[5],i=g[6];i=j}e=i;a=c("useObservable")(e);g=a[0];if(g!=null)return g}g["default"]=a}),98);
__d("useMarkOptimisticMessagesAsFailedIDB",["MAWIDBOptimisticMessageUtils","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function a(){return h}function h(a,b,c,d){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,e){yield d("MAWIDBOptimisticMessageUtils").markMessageSendAsFailed(a,c,e)});return i.apply(this,arguments)}g["default"]=a}),98);
__d("useMediaMAW",["FBLogger","MAWDbMedia","MAWDbMsg","MAWGetAttachmentThumbnailBlob","MAWLiveQuery","MAWMediaUIConverter","MAWMessageAttachmentCache","MAWMsg","nullthrows","react","react-compiler-runtime","relay-runtime/network/RelayObservable","useMawDbInUI","useObservable"],(function(a,b,c,d,e,f,g){"use strict";var h;(h||d("react")).useMemo;function a(a,b){var e=d("react-compiler-runtime").c(14),g=c("useMawDbInUI")(),h;bb0:{if(e[0]!==b||e[1]!==g||e[2]!==a){var i=d("MAWDbMsg").toMsgId(a.messageId);if(i==null){b&&c("FBLogger")("messenger_e2ee_web").warn("[useMediaAttachmentsMAW]] unexpected messageId format: %s",a.messageId);var k;e[5]===Symbol["for"]("react.memo_cache_sentinel")?(k=c("relay-runtime/network/RelayObservable").from(),e[5]=k):k=e[5];h=k;break bb0}e[6]!==b||e[7]!==a?(k=b&&d("MAWMsg").isMediaMsg(a)&&!d("MAWMsg").isReceiverFetchMsg(a)&&!d("MAWMsg").isXMAMsg(a),e[6]=b,e[7]=a,e[8]=k):k=e[8];k=d("MAWLiveQuery").maybeCreate(k,function(){return d("MAWLiveQuery").createMawObservable(g,function(a){return a.openReadonlyTransaction(["messages","media"],function(a){return a.messages.where("msgId").equals(i).first().then(function(b){var d=b==null?void 0:b.mediaId;if(d==null)return;return a.media.get(d).then(function(a){return{dbMsg:c("nullthrows")(b),hasMediaForUI:!0,media:a}})})})},function(b){if(b==null)return;var c=b.dbMsg,e=b.hasMediaForUI;b=b.media;e=d("MAWMediaUIConverter").mawToLS(a.threadKey,e,c,b);e!=null&&b!=null&&j(a.messageId,b);return{attachment:e,media:b}},f.id+":62")});e[0]=b;e[1]=g;e[2]=a;e[3]=k;e[4]=h}else k=e[3],h=e[4];h=k}b=h;k=c("useObservable")(b);b=k[0];if(e[9]!==(b==null?void 0:b.attachment)||e[10]!==a){k=(k=b==null?void 0:b.attachment)!=null?k:d("MAWMessageAttachmentCache").getAttachmentForMessage(a);e[9]=b==null?void 0:b.attachment;e[10]=a;e[11]=k}else k=e[11];b=k;e[12]!==b?(k=b!=null?[b]:null,e[12]=b,e[13]=k):k=e[13];return k}function i(a,b,c){if(b.blobData==null||b.mimetype==null)return;b=new Blob([b.blobData],{type:b.mimetype});b=URL.createObjectURL(b);c(a,b)}function j(a,b){if(b.mediaType===d("MAWDbMedia").MEDIA_TYPE.IMAGE||b.mediaType===d("MAWDbMedia").MEDIA_TYPE.VIDEO){b=k(b);b=b.thumbnailBlob;i(a,{blobData:b,mimetype:"image/jpeg"},d("MAWGetAttachmentThumbnailBlob").setEagerThumbnailUrl)}}function k(a){var b,c=null;switch(a.mediaType){case d("MAWDbMedia").MEDIA_TYPE.IMAGE:c=(b=a.validatedImageInfo)==null?void 0:b.jpegThumbnail;break;case d("MAWDbMedia").MEDIA_TYPE.VIDEO:c=(b=a.validatedVideoInfo)==null?void 0:b.jpegThumbnail;break}return{thumbnailBlob:c,thumnailPlaintextHash:null}}g["default"]=a}),98);
__d("useReactionsMAW",["FBLogger","MAWDbMsg","MAWLiveQuery","MAWReactionUIConverter","react","react-compiler-runtime","relay-runtime/network/RelayObservable","useMawDbInUI","useObservable"],(function(a,b,c,d,e,f,g){"use strict";var h;(h||d("react")).useMemo;function a(a,b){var e=d("react-compiler-runtime").c(9),g=c("useMawDbInUI")(),h;bb0:{if(e[0]!==b||e[1]!==g||e[2]!==a.messageId||e[3]!==a.threadKey){var i=d("MAWDbMsg").toMsgId(a.messageId);if(i==null){b&&c("FBLogger")("messenger_e2ee_web").warn("[useReactionsMAW] unexpected messageId format: %s",a.messageId);var j;e[6]===Symbol["for"]("react.memo_cache_sentinel")?(j=c("relay-runtime/network/RelayObservable").from(),e[6]=j):j=e[6];h=j;break bb0}j=d("MAWLiveQuery").maybeCreate(b,function(){return d("MAWLiveQuery").createMawObservable(g,function(a){return a.openReadonlyTransaction(["reactions"],function(a){return a.reactions.where("reactToMsgId").equals(i).toArray()})},function(b){return b.map(function(b){return d("MAWReactionUIConverter").mawToLS(b,a.threadKey)}).filter(Boolean)},f.id+":49")});e[0]=b;e[1]=g;e[2]=a.messageId;e[3]=a.threadKey;e[4]=j;e[5]=h}else j=e[4],h=e[5];h=j}b=h;j=c("useObservable")(b);b=j[0];if(e[7]!==b){j=(j=b)!=null?j:[];e[7]=b;e[8]=j}else j=e[8];return j}g["default"]=a}),98);
__d("useReceiverFetchMediaMAW",["FBLogger","MAWDbMsg","MAWLiveQuery","MAWMessageAttachmentCache","MAWMsg","MAWReceiverFetchMediaUIConvertor","react","react-compiler-runtime","relay-runtime/network/RelayObservable","useMawDbInUI","useObservable"],(function(a,b,c,d,e,f,g){"use strict";var h;(h||d("react")).useMemo;function a(a,b){var e=d("react-compiler-runtime").c(14),g=c("useMawDbInUI")(),h;bb0:{if(e[0]!==b||e[1]!==g||e[2]!==a){var i=d("MAWDbMsg").toMsgId(a.messageId);if(i==null){b&&c("FBLogger")("messenger_e2ee_web").warn("[useReceiverFetchMediaMAW]] unexpected messageId format: %s",a.messageId);var j;e[5]===Symbol["for"]("react.memo_cache_sentinel")?(j=c("relay-runtime/network/RelayObservable").from(),e[5]=j):j=e[5];h=j;break bb0}e[6]!==b||e[7]!==a?(j=b&&d("MAWMsg").isReceiverFetchMsg(a),e[6]=b,e[7]=a,e[8]=j):j=e[8];j=d("MAWLiveQuery").maybeCreate(j,function(){return d("MAWLiveQuery").createMawObservable(g,function(a){return a.openReadonlyTransaction(["messages","receiverFetchInfo"],function(a){return a.messages.where("msgId").equals(i).first().then(function(b){var d=b==null?void 0:b.receiverFetchId;if(b==null||d==null)return;return a.receiverFetchInfo.get(d).then(function(a){if(a==null){c("FBLogger")("messenger_e2ee_web").warn("[useReceiverFetchMediaMAW] unexpected missing receiverFetchInfo for msg");return}return{msg:b,receiverFetchInfo:a}})})})},function(b){if(b==null)return;var c=b.msg;b=b.receiverFetchInfo;return d("MAWReceiverFetchMediaUIConvertor").mawToLS(c,b,a.threadKey)},f.id+":46")});e[0]=b;e[1]=g;e[2]=a;e[3]=j;e[4]=h}else j=e[3],h=e[4];h=j}b=h;j=c("useObservable")(b);b=j[0];if(e[9]!==b||e[10]!==a){j=(j=b)!=null?j:d("MAWMessageAttachmentCache").getAttachmentForMessage(a);e[9]=b;e[10]=a;e[11]=j}else j=e[11];b=j;e[12]!==b?(j=b!=null?[b]:null,e[12]=b,e[13]=j):j=e[13];return j}g["default"]=a}),98);