;/*FB_PKG_DELIM*/

__d("ArmadilloTaskHandlers",["JSResourceForInteraction"],(function(a,b,c,d,e,f,g){"use strict";b={add:(a=c("JSResourceForInteraction"))("AddTaskHandler").__setRef("ArmadilloTaskHandlers"),get_messenger_db_dump_attachments_for_bug_reporting:a("GetMessengerDBDumpAttachments").__setRef("ArmadilloTaskHandlers"),maw_get_devices:a("MAWGetDevicesTaskHandler").__setRef("ArmadilloTaskHandlers"),preload_messenger_db_dump_attachments_for_bug_reporting:a("PreloadDBDumpAttachments").__setRef("ArmadilloTaskHandlers"),test:a("TestNativeTaskHandler").__setRef("ArmadilloTaskHandlers"),zenon_send_chatd_mws_message:a("MAWZenonSendMultiwayMsgChatdTaskHandler").__setRef("ArmadilloTaskHandlers")};g.TASK_HANDLERS_RESOURCES=b}),98);
__d("BroadcastChannelClientServerHandshake",["FBLogger","Promise","Random","setTimeout"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a){a.addEventListener("message",function(b){var c;((c=b.data)==null?void 0:c.type)==="BroadcastChannelHandshake-syn"&&a.postMessage({nonce:b.data.nonce,type:"BroadcastChannelHandshake-syn-ack"})})}function e(a,e){var f=d("Random").random(),g=0;return new(h||(h=b("Promise")))(function(b,d){var h=!1,i=function b(){if(g===6){h=!0;a.removeEventListener("message",j);try{throw c("FBLogger")("ls_web_init").mustfixThrow("BC handshake failed, failing, likely worker failure%s",e!=null?" for"+e:"")}catch(a){d(a)}return}if(h)return;a.postMessage({nonce:f,type:"BroadcastChannelHandshake-syn"});c("setTimeout")(b,100*Math.pow(2,g++))},j=function c(d){var e;((e=d.data)==null?void 0:e.type)==="BroadcastChannelHandshake-syn-ack"&&((e=d.data)==null?void 0:e.nonce)===f&&(b(),h=!0,a.removeEventListener("message",c))};a.addEventListener("message",j);i()})}g.listen=a;g.checkAlive=e}),98);
__d("CometTaskFrameworkTypes",["$InternalEnum"],(function(a,b,c,d,e,f){"use strict";a=b("$InternalEnum").Mirrored(["UNKNOWN","BACKGROUND","CURRENT_THREAD","LS_WORKER","MAW_WORKER","TEST"]);c="comet_task_framework";f.ExecutionContext=a;f.TASK_FRAMEWORK_PREFIX=c}),66);
__d("EBLSDeferred",["requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h=c("requireDeferred")("EBLS").__setRef("EBLSDeferred");function a(){return h.load().then(function(a){return a.init()})}function b(){return h.load().then(function(a){return a.genLSClient()})}function d(){return h.load().then(function(a){return a.getLSStorage()})}function e(a,b,c){return h.load().then(function(d){return d.platformClientInit(a,b,c)})}g.init=a;g.genLSClient=b;g.getLSStorage=d;g.platformClientInit=e}),98);
__d("MAWDbGroupInviteTxns",["MAWDexieTable","MAWMsgType"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){return a.groupInvites.put(b).then(function(){return b})}function b(a,b,c){return a.groupInvites.where(["threadJid","inviteeJid"]).anyOf([[b,c]])["delete"]()}function h(a,b,c){return a.groupInvites.where(["threadJid","inviteeJid"]).equals([b,c]).first()}function c(a,b,c){return a.groupInvites.where(["threadJid","inviteeJid"]).anyOf([[b,c]]).toArray()}function e(a,b){return b.type===d("MAWMsgType").MSG_TYPE.GROUP_INVITE?b.invitedParticipantUserJid==null?d("MAWDexieTable").dexieResolve():h(a,b.threadJid,b.invitedParticipantUserJid):d("MAWDexieTable").dexieResolve()}g.putGroupInvite=a;g.deleteGroupInvitesByThreadAndInvitedParticipant=b;g.maybeGetGroupInvite=h;g.getGroupInvitesByThreadAndInvitedParticipant=c;g.getAndCheckGroupInviteFromMsg=e}),98);
__d("MAWDebugMsg",["MAWBridgeMsg","MAWDbMsg","MAWDbMsgTxns","MAWDbThreadTxns","MAWDexieTable","MAWIndexedDb","MAWLocalizationType","MAWLocalizationUtils","MAWMsgType","MAWTransactionMode","MAWTransactor","WATimeUtils","gkx"],(function(a,b,c,d,e,f,g){"use strict";b=d("MAWTransactor").makeMsgrTransactor({chunk:(a=d("MAWTransactionMode")).READONLY,groupInfo:a.READONLY,media:a.READONLY,messages:a.READWRITE,participants:a.READONLY,threads:a.READWRITE},"writeDebugMsg",function(a){return function(b,e,f){return!c("gkx")("23958")?d("MAWDexieTable").dexieResolve():d("MAWDbThreadTxns").getThread(a,b).then(function(b){if(!b.success)return;var c=b.value;return d("MAWDexieTable").dexieAll([d("MAWDbMsgTxns").getThreadNewestMessageBySortOrder(a,c.jid),d("MAWDbMsgTxns").getThreadNewestMessageTs(a,c),(f==null?void 0:f.decryptionError)==="errDuplicateMsg"?d("MAWDbMsgTxns").maybeGetMsgByProtocolMsgId(a,f.protocolMsgId).then(function(a){if(a==null)return", no existing message";return a.type===d("MAWMsgType").MSG_TYPE.CIPHERTEXT?", existing ciphertext message":",  existing message"}):d("MAWDexieTable").dexieResolve(""),d("MAWDbMsgTxns").getNextMsgIdNumberForThread(a,c)]).then(function(a){var b=a[0],f=a[1],g=a[2];a=a[3];a=d("MAWDbMsg").craftDebugMsgId(c.chatId,a-1);f=d("WATimeUtils").castToMillisTime(((b=(b=b==null?void 0:b.sortOrderMs)!=null?b:f)!=null?b:0)+1);b=d("MAWLocalizationUtils").buildUnstoredDbAdminMsg({adminMsgContent:["[fb-only][DEBUG]: "+(e+g)],adminType:d("MAWLocalizationType").LOCALIZATION_TYPE.DEBUG_MSG,version:0},c.jid);d("MAWIndexedDb").afterTransaction({tag:"NewMsg",value:d("MAWBridgeMsg").createBridgeMsg(babelHelpers["extends"]({},b,{msgId:a,sortOrderMs:f}))})})})}});g.writeDebugMsg=b}),98);
__d("MAWGetEditMsgForSending",["MAWAckLevel","MAWAsMessageApplication","MAWDbEditMsgHistoryTxns","MAWDbMsgTxns","MAWDbThreadTxns","MAWDexieTable","MAWIndexedDb","MAWJidUtils","MAWTransactionMode","WAJids","WALogger","WAResultOrError","err"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[SendEditMsg] Failed to get originalMsg"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[SendEditMsg] Failed to get thread (success:",")"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[SendEditMsg] Failed to get originalMsgProtocolMsgId"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[SendEditMsg] Failed to get edit history"]);k=function(){return a};return a}b=d("MAWIndexedDb").makeMsgrTransactor({editMsgHistory:(a=d("MAWTransactionMode")).READONLY,messages:a.READONLY,participants:a.READONLY,reactions:a.READONLY,threads:a.READONLY},"getEditMsgForSending",function(a){return function(b,e){return l(a,b,e).then(function(a){if(!a.success)return{type:a.error};a=a.value.msg;var e=d("MAWAsMessageApplication").asEditMessageApplication(a);if(d("WAJids").isAuthorSystem(a.author))throw c("err")("This cannot happen because there are no system edit");return{dbMsg:a,editOriginalExternalId:a.originalMsgExternalId,messageApplication:e,messageType:{isRevoked:!1,type:"text"},protocolMsgId:b,type:"unsent"}})}});function l(a,b,c){return d("MAWDbEditMsgHistoryTxns").getEditHistoryMsgByEditedProtocolMsgId(a,b,c).then(function(b){if(b==null){d("WALogger").ERROR(k());return d("WAResultOrError").makeError("missing_history")}else if(b.sendStatus!=null&&b.sendStatus>d("MAWAckLevel").ACK.clock)return d("WAResultOrError").makeError("sent");var c=d("MAWJidUtils").maybeToProtocolMsgId(b.author,b.threadJid,b.originalMsgExternalId);if(c==null){d("WALogger").ERROR(j());return d("WAResultOrError").makeError("missing_msg")}return d("MAWDexieTable").dexieAll([d("MAWDbThreadTxns").getThread(a,b.threadJid),d("MAWDbMsgTxns").maybeGetMsgByProtocolMsgId(a,c)]).then(function(a){var c=a[0];a=a[1];if(!c.success){d("WALogger").ERROR(i(),c.success);return d("WAResultOrError").makeError("missing_thread")}if(a==null){d("WALogger").ERROR(h());return d("WAResultOrError").makeError("missing_msg")}return a.ack>d("MAWAckLevel").ACK.clock?d("WAResultOrError").makeError("sent"):d("WAResultOrError").makeResult({msg:b,thread:c.value})})})}g.getEditMsgForSending=b}),98);
__d("MAWMediaType",["WAServerMediaType"],(function(a,b,c,d,e,f,g){"use strict";function a(a){switch(a){case"XMA":return"xma-image";case"EphemeralScreenshotAction":case"Raven":case"RavenAction":case"EditAction":case"BumpExistingMessage":return null;default:return d("WAServerMediaType").getMediaType(a)}}g.getMediaType=a}),98);
__d("MAWSendMsgUtil",["MAWMediaType","WAMsgType"],(function(a,b,c,d,e,f,g){"use strict";({});function h(a){var b=d("MAWMediaType").getMediaType(a),c=a===d("WAMsgType").MSG_TYPE.REVOKED;if(b!=null)return{mediaType:b,type:"media"};else if(a===d("WAMsgType").MSG_TYPE.SK_DISTRIBUTION)return{isInvisible:!0,isRevoked:!1,type:"text"};else return{isRevoked:c,type:"text"}}function a(a){var b=d("MAWMediaType").getMediaType(a);if(b!=null)return{mediaType:b,type:"media"};switch(a){case"XMA":case"Raven":case"RavenAction":case"EphemeralScreenshotAction":case"EditAction":case"BumpExistingMessage":return{isRevoked:!1,type:"text"};default:return h(a)}}g.waGetMessageTypeFromMsg=h;g.getMessageTypeFromMsg=a}),98);
__d("MAWGetMsgForSendingApi",["MAWAckLevel","MAWAsMessageApplication","MAWDbGroupInviteTxns","MAWDbMediaTxns","MAWDbMsg","MAWDbMsgTxns","MAWDbParticipantTxns","MAWDbUnrenderedMsgTxns","MAWDbXMATxns","MAWDexieTable","MAWIndexedDb","MAWMsgType","MAWSendMsgUtil","MAWTransactionMode","MAWXMAUtils","WAJids","WALogger","WAResultOrError","err"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[SendMsg] Failed to get XMA: isXma: ",", type: "," "]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[SendMsg] Failed to get message"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenMsg "," -- MAWGetMsgForSendingAPI -- Done"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenMsg "," -- MAWGetMsgForSendingAPI -- Unrecognized type ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenMsg "," -- MAWGetMsgForSendingAPI -- Error: ",""]);l=function(){return a};return a}b=d("MAWIndexedDb").makeMsgrTransactor({groupInvites:(a=d("MAWTransactionMode")).READONLY,media:a.READONLY,messages:a.READONLY,participants:a.READONLY,reactions:a.READONLY,threads:a.READONLY,unrenderedMessages:a.READONLY,xma:a.READONLY},"getMsgForSending",function(a){return function(b){return m(a,b).then(function(a){if(!a.success){d("WALogger").LOG(l(),b,a.error);return{type:a.error}}a=a.value;var e=a.contactsInThread,f=a.groupInvite,g=a.isReplyMsg,h=a.media,i=a.msg;a=a.xmaPayload;if(!d("MAWDbMsg").NO_CONTENT_MESSAGE_TYPES_ALLOWLIST.includes(i.type)&&!d("MAWDbMsg").isContentMsg(i)){d("WALogger").LOG(k(),b,i.type);throw c("err")("We do not support message sending with "+i.type+" type")}var m=d("MAWAsMessageApplication").asMessageApplication(i,h,f,a),n=null;i.type===d("MAWMsgType").MSG_TYPE.GROUP_INVITE&&f?n={invitedParticipantUserJid:f.inviteeJid,isRevoked:!1,type:"text"}:n=d("MAWSendMsgUtil").getMessageTypeFromMsg(i.type);if(d("WAJids").isAuthorSystem(i.author))throw c("err")("A system message cannot be sent");d("WALogger").LOG(j(),b);return{contactsInThread:e,dbMsg:i,isReplyMsg:g,isXMAMsg:a!=null,media:h,messageApplication:m,messageType:n,protocolMsgId:{author:i.author,chat:i.threadJid,externalId:a!=null&&a.associatedMessage!=null?a.associatedMessage.externalId:i.externalId},type:"unsent",xmaPayload:a}})}});function m(a,b){return d("MAWDexieTable").dexieAll([d("MAWDbMsgTxns").maybeGetMsgByProtocolMsgId(a,b),d("MAWDbUnrenderedMsgTxns").maybeGetUnrenderedMsgByProtocolMsgId(a,b)]).then(function(c){var e=c[0];c=c[1];var f=c.value,g=e||f;if(g==null){d("WALogger").ERROR(i());return d("WAResultOrError").makeError("missing_msg")}else if(g.ack>d("MAWAckLevel").ACK.clock)return d("WAResultOrError").makeError("sent");var j=d("MAWXMAUtils").maybeXMAMessage(e),k=g.quote!=null;return d("MAWDexieTable").dexieAll([e?d("MAWDbMediaTxns").getAndCheckMediaFromMsg(a,e):d("MAWDexieTable").dexieResolve(d("WAResultOrError").makeResult()),c.success?d("MAWDbGroupInviteTxns").getAndCheckGroupInviteFromMsg(a,c.value):d("MAWDexieTable").dexieResolve(),j?d("MAWDbXMATxns").maybeGetXMAPayloadFromProtocolMsgId(a,b):null,d("MAWDbParticipantTxns").getParticipantsInThread(a,g.threadJid).then(function(a){return a.map(function(a){return a.userJid})})]).then(function(a){var b=a[0],c=a[1],e=a[2];a=a[3];if(!b.success)return b;if(e!=null&&!e.success){d("WALogger").ERROR(h(),j,g.type);return d("WAResultOrError").makeError("missing_xma")}b=b.value;return d("WAResultOrError").makeResult({contactsInThread:a,groupInvite:c,isReplyMsg:k,media:b,msg:g,xmaPayload:e!=null?e.value:null})})})}g.getMsgForSending=b}),98);
__d("MAWGetReactionForSending",["MAWAckLevel","MAWAsMessageApplication","MAWDbReactionsTxns","MAWDbThreadTxns","MAWIndexedDb","MAWTransactionMode","WAJids","WAResultOrError","err"],(function(a,b,c,d,e,f,g){"use strict";function h(a,b){return d("MAWDbReactionsTxns").getReaction(a,b).then(function(b){if(b==null)return d("WAResultOrError").makeError("missing");else if(b.ack>d("MAWAckLevel").ACK.clock)return d("WAResultOrError").makeError("sent");return d("MAWDbThreadTxns").getThread(a,b.threadJid).then(function(a){return!a.success?d("WAResultOrError").makeError(a.error):d("WAResultOrError").makeResult({msg:b})})})}a=d("MAWIndexedDb").makeMsgrTransactor({reactions:d("MAWTransactionMode").READONLY,threads:d("MAWTransactionMode").READONLY},"getReactionForSending",function(a){return function(b){return h(a,b).then(function(a){if(!a.success)return{type:a.error};a=a.value.msg;var b=d("MAWAsMessageApplication").asReactionMessageApplication(a);if(d("WAJids").isAuthorSystem(a.author))throw c("err")("This cannot happen because there are no system reactions");return{chat:a.threadJid,dbMsg:a,externalId:a.externalId,messageApplication:b,messageType:{isInvisible:!0,type:"reaction"},protocolMsgId:{author:a.author,chat:a.threadJid,externalId:a.externalId},type:"unsent"}})}});g.getReactionForSending=a}),98);
__d("MAWLoadThreadParticipantsApi",["MAWDbParticipantTxns","MAWIndexedDb","MAWTransactionMode","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["MAWLoadThreadParticipantsApi -- loadThreadParticipants -- there is no thread in db"]);h=function(){return a};return a}a=d("MAWIndexedDb").makeMsgrTransactor({participants:d("MAWTransactionMode").READONLY,threads:d("MAWTransactionMode").READONLY},"loadThreadParticipants",function(a){return function(b){return a.threads.get({jid:b}).then(function(b){if(b==null){d("WALogger").ERROR(h());return[]}return d("MAWDbParticipantTxns").getParticipantsInThread(a,b.jid).then(function(a){return a.map(function(a){return a.userJid})})})}});g.loadThreadParticipants=a}),98);
__d("MAWMarkEditMsgDroppedApi",["FBLogger","MAWAckLevel","MAWBridgeMsg","MAWBridgeTypesCreators","MAWDbEditMsgHistoryTxns","MAWDbMsgTxns","MAWDexieTable","MAWIndexedDb","MAWJidUtils","MAWThreadSnippetForTextMsg","MAWThreadUpdateMiddlewareGatingUtil","MAWTransactionMode","WAGlobals","WAJids","WALogger","WAMsgType","WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[markEditMsgDropped] editMsgHistory updated"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[markEditMsgDropped] originalMsg is not a text message"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[markEditMsgDropped] thread is null"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[markEditMsgDropped] newestEditedMsg is not the newest edit"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["[markEditMsgDropped] previousEditedMsg is null"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["[markEditMsgDropped] newestEditedMsg is null"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["[markEditMsgDropped] originalMsg is null"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["[markEditMsgDropped] originalProtocolMsgId is null"]);o=function(){return a};return a}a=d("MAWIndexedDb").makeMsgrTransactor({editMsgHistory:d("MAWTransactionMode").READWRITE,messages:d("MAWTransactionMode").READWRITE,threads:d("MAWTransactionMode").READWRITE},"markEditMsgDropped",function(a){return function(b,e){var f=d("MAWJidUtils").maybeToProtocolMsgId(b.author,b.chat,e);if(f==null){d("WALogger").ERROR(o());return d("MAWDexieTable").dexieResolve(d("WAResultOrError").makeError("missing_original_protocol_msg_id"))}return d("MAWDexieTable").dexieAll([a.threads.get({jid:b.chat}),d("MAWDbMsgTxns").maybeGetMsgByProtocolMsgId(a,f),d("MAWDbEditMsgHistoryTxns").maybeGetEditMsgHistoryFromProtocolMsgId(a,f)]).then(function(f){var g=f[0],o=f[1],p=f[2];f=p.sort(function(a,b){return b.editTs-a.editTs});var q=p.find(function(a){return a.editExternalId===b.externalId}),r=f[1];if(o==null){d("WALogger").ERROR(n());return d("WAResultOrError").makeError("missing_original_msg")}if(q==null){d("WALogger").ERROR(m());return d("WAResultOrError").makeError("missing_newest_edited_msg")}if(r==null){d("WALogger").ERROR(l());return d("WAResultOrError").makeError("missing_previous_edited_msg")}if(q.editExternalId!==f[0].editExternalId){d("WALogger").ERROR(k());return d("WAResultOrError").makeError("invalid_newest_edited_msg")}if(g==null){d("WALogger").ERROR(j());return d("WAResultOrError").makeError("missing_thread")}if(o.type!==d("WAMsgType").MSG_TYPE.TEXT){d("WALogger").ERROR(i());return d("WAResultOrError").makeError("invalid_original_msg")}return d("MAWDexieTable").dexieAll([a.messages.where("quoteExternalId").equals(e).toArray(),d("MAWDbMsgTxns").getThreadNewestMessageId(a,g.jid)]).then(function(e){var f=e[0],i=e[1],j=babelHelpers["extends"]({},o,{ack:d("MAWAckLevel").ACK.sent,editCount:((e=o.editCount)!=null?e:0)-1,msgContent:r.msgContent}),k=d("WAGlobals").getMyUserJid(),l=[];e=f.find(function(a){var c;return(((c=a.quote)==null?void 0:c.content.author)===d("WAJids").AUTHOR_ME||((c=a.quote)==null?void 0:c.content.author)===k)&&a.threadJid===b.chat});if(e!=null){f=e.quote;var m=e.quoteExternalId;if(f==null)c("FBLogger")("messenger_e2ee_web").warn("[markEditMsgDropped] Failed to get the quoted content for a msg that has been quoted.",m);else{m=babelHelpers["extends"]({},e,{quote:babelHelpers["extends"]({},f,{content:babelHelpers["extends"]({},f.content,{msgContent:babelHelpers["extends"]({},j.msgContent)})})});l.push(m)}}e=[];o.editCount===1&&p.length===2&&e.push(r.editMsgHistoryId);e.push(q.editMsgHistoryId);return d("MAWDexieTable").dexieAll([a.messages.put(j),a.editMsgHistory.bulkDelete(e)]).then(function(){d("WALogger").LOG(h());d("MAWIndexedDb").afterTransaction({tag:"MsgUpdated",value:d("MAWBridgeMsg").createBridgeMsg(j)});l.forEach(function(a){d("MAWIndexedDb").afterTransaction({tag:"MsgUpdated",value:d("MAWBridgeMsg").createBridgeMsg(a)})});if(i===o.msgId&&!d("MAWThreadUpdateMiddlewareGatingUtil").isThreadUpdateEnabledViaMiddlewareForMsgType(j.type)){var a=d("WAJids").userIdFromJid(d("WAGlobals").getMyUserJid()),b=c("MAWThreadSnippetForTextMsg")(j,a,d("WAJids").interpretAsGroupJid(g.jid)!=null),e=b.snippetParams;b=b.snippetType;d("MAWIndexedDb").afterTransaction({tag:"ThreadUpdated",value:d("MAWBridgeTypesCreators").createBridgeUpdatedThread({snippetParams:e,snippetSenderContactId:a,snippetType:b,threadJid:g.jid})})}return d("WAResultOrError").makeResult()})})})}});g.markEditMsgDropped=a}),98);
__d("MAWMarkEditMsgSentApi",["ArmadilloDataTraceType","MAWAckLevel","MAWBridgeMsg","MAWBridgeTrace","MAWBridgeTraceEvent","MAWDbEditMsgHistory","MAWDbEditMsgHistoryTxns","MAWDbMsgTxns","MAWDexieTable","MAWFTSTxns","MAWIndexedDb","MAWJidUtils","MAWLoadReplyMediaTxns","MAWTransactionMode","WAJids","WALogger","WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[markEditMsgSent] editMsgHistory updated"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[markEditMsgSent] on incoming message"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[markEditMsgSent] editMsgHistory has already been sent"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[markEditMsgSent] editedMsg?.editExternalId is null"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["[markEditMsgSent] originalMsgHistory is null"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["[markEditMsgSent] originalMsg is null"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["[markEditMsgSent] originalProtocolMsgId is null"]);n=function(){return a};return a}b=d("MAWIndexedDb").makeMsgrTransactor({chunk:(a=d("MAWTransactionMode")).READONLY,editMsgHistory:a.READWRITE,ftsBackloggedMessages:a.READWRITE,media:a.READONLY,messages:a.READWRITE,receiverFetchInfo:a.READONLY,xma:a.READONLY},"markMsgSent",function(a){return function(b,e,f,g){var o=d("MAWJidUtils").maybeToProtocolMsgId(b.author,b.chat,e);if(o==null){d("WALogger").ERROR(n());return d("MAWDexieTable").dexieResolve(d("WAResultOrError").makeError("missing_original_protocol_msg_id"))}return d("MAWDexieTable").dexieAll([d("MAWDbMsgTxns").maybeGetMsgByProtocolMsgId(a,o),d("MAWDbEditMsgHistoryTxns").maybeGetEditMsgHistoryFromProtocolMsgId(a,o),d("MAWFTSTxns").maybePutMessageToBacklog(a,e)]).then(function(n){var o=n[0];n=n[1];var p=n.find(function(a){return a.editExternalId===e}),q=n.find(function(a){return a.editExternalId===b.externalId});if(o==null){d("WALogger").ERROR(m());return d("WAResultOrError").makeError("missing_original_msg")}if(p==null){d("WALogger").ERROR(l());return d("WAResultOrError").makeError("missing_original_msg_edit_history")}if((q==null?void 0:q.editExternalId)==null){d("WALogger").ERROR(k());return d("WAResultOrError").makeError("missing_edit_external_id")}if(q.sendStatus!=null&&q.sendStatus>d("MAWAckLevel").ACK.clock&&o.ack>d("MAWAckLevel").ACK.clock){d("WALogger").LOG(j());return d("WAResultOrError").makeError("already_sent")}if(q.author!==d("WAJids").AUTHOR_ME){d("WALogger").ERROR(i());return d("WAResultOrError").makeError("not_author")}d("MAWIndexedDb").afterTransaction({tag:"UpdateTrace",value:d("MAWBridgeTrace").createBridgeUpdateTraceData([q.editExternalId],c("MAWBridgeTraceEvent").ReceivedSent,d("ArmadilloDataTraceType").armadilloMessageSend)});var r=[];if(n.length===2&&o.editCount===1){n=babelHelpers["extends"]({},p,{sendStatus:d("MAWAckLevel").ACK.sent});r.push(n)}p=babelHelpers["extends"]({},q,{editTs:f,sendStatus:d("MAWAckLevel").ACK.sent});r.push(p);var s=r.map(function(a){return babelHelpers["extends"]({},a,{editMsgHistoryId:d("MAWDbEditMsgHistory").convertToEditMsgHistoryId64(a.editMsgHistoryId),originalMsgId:o.msgId})}),t=babelHelpers["extends"]({},o,{ack:d("MAWAckLevel").ACK.sent});g!=null&&(t.reportingMeta=g);return d("MAWDexieTable").dexieAll([a.editMsgHistory.bulkPut(r),a.messages.put(t),d("MAWLoadReplyMediaTxns").getReplyMediaForMsgQuote(a,t)]).then(function(a){a[0];a=a[2];d("WALogger").LOG(h());d("MAWIndexedDb").afterTransaction({tag:"MsgUpdated",value:d("MAWBridgeMsg").createBridgeMsg(t,void 0,a)});d("MAWIndexedDb").afterTransaction({tag:"EditMsgHistoryAdded",value:s});return d("WAResultOrError").makeResult()})})}});g.markEditMsgSent=b}),98);
__d("MAWMarkMsgDroppedApi",["MAWAckLevel","MAWDbMsgTxns","MAWDbReactionsTxns","MAWDexieTable","MAWIndexedDb","MAWTransactionMode"],(function(a,b,c,d,e,f,g){"use strict";b=d("MAWIndexedDb").makeMsgrTransactor({chunk:(a=d("MAWTransactionMode")).READONLY,media:a.READONLY,messages:a.READWRITE,reactions:a.READWRITE,receiverFetchInfo:a.READONLY,threads:a.READWRITE,xma:a.READONLY},"markMsgDropped",function(a){return function(b,c){c===void 0&&(c=!1);return d("MAWDexieTable").dexieAll([d("MAWDbMsgTxns").maybeGetMsgByProtocolMsgId(a,b),d("MAWDbReactionsTxns").maybeGetReactionByProtocolMsgId(a,b)]).then(function(b){var e=b[0];b=b[1];if(e!=null){var f=c?d("MAWAckLevel").ACK.failedRetryable:d("MAWAckLevel").ACK.expired;return d("MAWDbMsgTxns").updateSystemAck(a,e.msgId,f).then(function(a){return a==null?"missing":a.ack<=d("MAWAckLevel").ACK.clock?"dropped":"sent"})}return b!=null?d("MAWDbReactionsTxns").deleteReaction(a,b).then(function(){return"dropped"}):"missing"})}});g.markMsgDropped=b}),98);
__d("MAWMarkMsgSentApi",["ArmadilloDataTraceType","I64","MAWAckLevel","MAWBridgeTrace","MAWBridgeTraceEvent","MAWBridgeTypesCreators","MAWCalculateBumpTimestampMs","MAWDbMsg","MAWDbMsgTxns","MAWDbThread","MAWDbThreadTxns","MAWDbUnrenderedMsgTxns","MAWDexieTable","MAWEphemeralMsgTxns","MAWEphemeralSettingsTxns","MAWFolderTypes","MAWIndexedDb","MAWMsgType","MAWThreadNewestMsgOrReactionUtils","MAWThreadSnippetBuildTxns","MAWThreadUpdateMiddlewareGatingUtil","MAWTransactionMode","MAWUpdateThreadBumpTimestamp","WALogger","WATimeUtils","emptyFunction","gkx"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Thread missing from DB"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Found both regular and unrendered message with the same protocol msg ID"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Msg missing from DB"]);k=function(){return a};return a}b=d("MAWIndexedDb").makeMsgrTransactor({chunk:(a=d("MAWTransactionMode")).READONLY,ephemeralSettings:a.READWRITE,groupInfo:a.READONLY,media:a.READONLY,messages:a.READWRITE,reactions:a.READONLY,receiverFetchInfo:a.READONLY,threads:a.READWRITE,unrenderedMessages:a.READWRITE,xma:a.READONLY},"markMsgSent",function(a){return function(b,e,f){return d("MAWDexieTable").dexieAll([d("MAWDbMsgTxns").maybeGetMsgByProtocolMsgId(a,b),d("MAWDbUnrenderedMsgTxns").maybeGetUnrenderedMsgByProtocolMsgId(a,b)]).then(function(g){var m=g[0];g=g[1];if(m==null&&!g.success){d("WALogger").LOG(k());return}else if(m!=null){d("MAWIndexedDb").afterTransaction({tag:"UpdateTrace",value:d("MAWBridgeTrace").createBridgeUpdateTraceData([m.externalId],c("MAWBridgeTraceEvent").ReceivedSent,d("ArmadilloDataTraceType").armadilloMessageSend)});g.success&&d("WALogger").ERROR(j());var n=m.ack<d("MAWAckLevel").ACK.sent;return d("MAWDexieTable").dexieAll([d("MAWDbMsgTxns").updateSystemAck(a,m.msgId,d("MAWAckLevel").ACK.sent,e,f),d("MAWDbThreadTxns").getThread(a,m.threadJid)]).then(function(b){var c=b[0];b=b[1];if(!b.success){d("WALogger").ERROR(i());return}var f=b.value,g=d("WATimeUtils").castUnixTimeToMillisTime(e);b=babelHelpers["extends"]({},f,{lastReadMsgTs:g,newestMsgTs:g,threadOrder:d("MAWDbThread").craftThreadOrder(g,f.jid)});b=n?d("MAWDbThreadTxns").updateThread(a,b):d("MAWDexieTable").dexieResolve();return d("MAWDexieTable").dexieAll([l(a,f),d("MAWEphemeralMsgTxns").markEphemeralMessageAsSent(a,c),b]).then(function(){if(m.altIndex!==d("MAWDbMsg").SPAM_ALT_INDEX&&m.altIndex!==d("MAWDbMsg").FUTUREPROOF_SPAM_ALT_INDEX&&!d("MAWThreadUpdateMiddlewareGatingUtil").isThreadUpdateEnabledViaMiddlewareForMsgType(m.type)&&n)return d("MAWThreadSnippetBuildTxns").buildThreadSnippet(a,m).then(function(a){var b=a.snippetParams,c=a.snippetSenderContactId;a=a.snippetType;if(m.type===d("MAWMsgType").MSG_TYPE.REVOKED)d("MAWIndexedDb").afterTransaction({tag:"ThreadUpdated",value:d("MAWBridgeTypesCreators").createBridgeUpdatedThread({snippetParams:b,snippetSenderContactId:c,snippetType:a,threadJid:f.jid})});else if(!d("MAWThreadUpdateMiddlewareGatingUtil").isThreadUpdateEnabledViaMiddlewareForMsgType(m.type)){var e=m.externalId!==void 0?(h||(h=d("I64"))).of_string_opt(m.externalId):void 0;e=d("MAWCalculateBumpTimestampMs").calculateBumpTimestampMs(g,e);d("MAWIndexedDb").afterTransaction({tag:"ThreadBumpedV2",value:d("MAWBridgeTypesCreators").createBridgeBumpedThreadV2({bumpTimestampMs:e,description:"markMsgSent",isMessageAuthorMe:!0,snippetData:{params:b,senderContactId:c,type:a},threadJid:f.jid})})}})})})}else if(g.success){var o=g.value;return d("MAWDbUnrenderedMsgTxns").updateSystemAckForUnrenderedMsg(a,o.msgId,d("MAWAckLevel").ACK.sent).then(function(){if(o.type===d("MAWMsgType").MSG_TYPE.EPHEMERAL_SETTING_CHANGE_FROM_CURRENT_DEVICE)return d("MAWEphemeralSettingsTxns").updateContactWhenEphemeralSettingChangeMarkedSent(a,b.chat,e)})}}).then(c("emptyFunction"))}});function l(a,b){return!c("gkx")("8630")?d("MAWDexieTable").dexieResolve():d("MAWThreadNewestMsgOrReactionUtils").getNewestMsgOrReactionForBump(a,b.jid).then(function(a){d("MAWIndexedDb").afterTransaction({tag:"CreateE2EEMetadataThread",value:{bumpTimestampMs:d("MAWUpdateThreadBumpTimestamp").getBumpTimestampMs(a),creationSource:"outgoing_message_from_current_tab",folderId:(a=b.folder)!=null?a:d("MAWFolderTypes").INBOX,jid:b.jid,threadKeys:{authoritative:b.authoritativeThreadKey,optimistic:b.optimisticThreadKey}}})})}g.markMsgSent=b}),98);
__d("MAWMessageSendScheduler",["WorkerScheduler"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(){h==null&&(h=d("WorkerScheduler").makeScheduler("message-send",{concurrency:5,maxConcurrency:5,maxThrottleMs:500}));return h}g.messageSendScheduler=a}),98);
__d("MAWMessageSendsCommon",["MAWMarkMsgDroppedApi","MAWMessageSendScheduler","MAWQplProxy","WAGetSafeQPLError","WAPromiseDelays","WAResultOrError","WATagsLogger","WATimeUtils","WAWaitForComms","WorkerScheduler","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Guard: should not happen, result is null"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Message send fails: ",". Error text: ",""]);i=function(){return a};return a}var j=1e3,k=d("WATagsLogger").TAGS(["MessageSend"]);function l(a,b,c,d,e){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,e,f){d("MAWQplProxy").sendQplPointThroughBridge(a,"backend_reached",{annotations:{bool:{backendSetupReadyFromWorker:!d("WAWaitForComms").isStillWaitingForComms()}},instanceKey:b});var g;try{d("MAWQplProxy").sendQplPointThroughBridge(a,"wait_for_comms_start",{annotations:{},instanceKey:b});yield d("WAWaitForComms").waitForComms();d("MAWQplProxy").sendQplPointThroughBridge(a,"wait_for_comms_end",{annotations:{},instanceKey:b});d("MAWQplProxy").sendQplPointThroughBridge(a,"message_send_start",{annotations:{},instanceKey:b});g=(yield d("MAWMessageSendScheduler").messageSendScheduler().runTask({customFlags:{runtimeReliability:!0},fn:function(){return c(d("WATimeUtils").unixTime())},name:e,priority:d("WorkerScheduler").BLOCKING_PRIORITY}));if(g.success===!0)d("MAWQplProxy").sendQplPointThroughBridge(a,"message_send_end",{instanceKey:b});else{var m;d("MAWQplProxy").sendQplPointThroughBridge(a,"message_send_fail",{annotations:{string:{errorType:(m=(m=g.error)==null?void 0:m.type)!=null?m:"unknown-error"}},instanceKey:b})}}catch(c){k.ERROR(i(),c,d("WAGetSafeQPLError").getSafeQPLErrorMessage(c));d("MAWQplProxy").sendQplPointThroughBridge(a,"message_send_fail",{annotations:{string:{errorDescription:d("WAGetSafeQPLError").getSafeQPLErrorMessage(c),errorType:"runtime-error"}},instanceKey:b});f!=null&&(yield d("MAWMarkMsgDroppedApi").markMsgDropped(f));throw c}if(!g){m="null-response-from-message-send";k.ERROR(h());d("MAWQplProxy").sendQplPointThroughBridge(a,"message_send_fail",{instanceKey:b});return d("WAResultOrError").makeError({applicationErrorCode:null,details:m,isRetriable:!0,type:"unexpected-message-codepath"})}if(g.success===!0)return g;g.success;if(f!=null){m=((m=g.error)==null?void 0:m.isRetriable)===!0;yield d("MAWMarkMsgDroppedApi").markMsgDropped(f,m)}if(((m=g.error)==null?void 0:m.type)==="retryable-error"){m=(m=g.error.backoff)!=null?m:j;yield d("WAPromiseDelays").delayMs(m);return l(a,b,c,e,f)}else return g});return m.apply(this,arguments)}g.messageSendLogger=k;g.messageSendObserver=l}),98);
__d("WAQPLProxy",["WALogger","err"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["WAQPLProxy: Proxy implementation is not provided for ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["WAQPLProxy: Proxy implementation is not provided for ",""]);i=function(){return a};return a}function a(a,b,e,f,g){g===void 0&&(g=!0);if(j==null){d("WALogger").ERROR(i(),a);throw c("err")("WAQPLProxy: Proxy implementation is not provided")}return j.start(a,b,e,f,g)}function b(a,b){if(j==null){d("WALogger").ERROR(h(),a);throw c("err")("WAQPLProxy: Proxy implementation is not provided")}return j.resume(a,b)}var j=null;function e(a){j=a}g.waQPLProxyStart=a;g.waQPLProxyStartResume=b;g.provideProxyImplementationForWAQPLProxy=e}),98);
__d("MAWSendWrittenMsg",["EBAPI","FBLogger","I64","MAWBridge","MAWDebugMsg","MAWGetEditMsgForSending","MAWGetMsgForSendingApi","MAWGetReactionForSending","MAWJobManager","MAWLoadThreadParticipantsApi","MAWMarkEditMsgDroppedApi","MAWMarkEditMsgSentApi","MAWMarkMsgDroppedApi","MAWMarkMsgSentApi","MAWMessageSendsCommon","WAAPI","WAAsMessageApplication","WAFrankingTypes","WAJids","WAMsgApplication.pb","WAQPLProxy","WAResultOrError","asyncToGeneratorRuntime","encodeProtobuf","err","gkx","promiseDone","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenMsg END "," : ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenMsg not sending message: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenMsg ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenMsg(","): drop result: ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenMsg(","): too old, dropping"]);m=function(){return a};return a}a=24*60*60;function n(a,b){return o.apply(this,arguments)}function o(){o=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var e;d("MAWMessageSendsCommon").messageSendLogger.LOG(k(),a.protocolMsgId);var f=null;b.addPoint("get_msg_for_sending_start",{string:{type:a.type}});if(a.type==="message"||a.type==="revoke")f=(yield d("MAWGetMsgForSendingApi").getMsgForSending(a.protocolMsgId));else if(a.type==="reaction")f=(yield d("MAWGetReactionForSending").getReactionForSending(a.protocolMsgId));else if(a.type==="edit")f=(yield d("MAWGetEditMsgForSending").getEditMsgForSending(a.protocolMsgId,a.referencedOriginalExternalId));else{a.type;throw c("err")("This cannot happen because type has `message` as default argument but flow does not know that")}if(f.type!=="unsent"){d("MAWMessageSendsCommon").messageSendLogger.LOG(j(),f.type);return d("WAResultOrError").makeError({details:f.type,isRetriable:!0,type:"wrong-message-state"})}a=f;f=a.dbMsg;var g=a.editOriginalExternalId,l=a.isReplyMsg,m=a.isXMAMsg,n=a.media,o=a.messageApplication,p=a.messageType,q=a.protocolMsgId;a=a.xmaPayload;b.addPoint("get_msg_for_sending_end",{bool:{isEditMsg:g!=null,isReplyMsg:l,isXMAMsg:m},string:{msgType:p.type}});l={bytes:d("WAAsMessageApplication").castToMessageApplicationBytes(d("encodeProtobuf").encodeProtobuf(d("WAMsgApplication.pb").MessageApplicationSpec,o).readByteArray()),version:"v3"};b.addPoint("wa_send_msg_start");e=(yield c("WAAPI").sendChatMessage({loadThreadParticipants:d("MAWLoadThreadParticipantsApi").loadThreadParticipants,messagePayload:{backupDirective:null,frankingKey:((e=o.metadata)==null?void 0:e.frankingKey)?d("WAFrankingTypes").castToFrankingKey(new Uint8Array((e=o.metadata)==null?void 0:e.frankingKey)):null,frankingVersion:(e=o.metadata)==null?void 0:e.frankingVersion,messageBytes:l,messageType:p,protocolMsgId:q}},b));if(e.success===!1){b.addPoint("wa_send_msg_fail",{string:{errorType:e.error.type,msgType:f.type}});if(g!=null)yield d("MAWMarkEditMsgDroppedApi").markEditMsgDropped(q,g);else{p=e.error.isRetriable===!0;yield d("MAWMarkMsgDroppedApi").markMsgDropped(q,p)}d("MAWMessageSendsCommon").messageSendLogger.ERROR(i(),e.error.type,(p=e.payload)!=null?p:"");switch(e.error.type){case"non-retryable-error":p=c("gkx")("794");if(p&&e.error.applicationErrorCode!=null&&e.error.applicationErrorCode===10009)try{d("MAWBridge").getBridge().fireAndForget("event","uiUpdate",{events:[{tag:"RefreshContact",value:(h||(h=d("I64"))).of_string(d("WAJids").threadIdForChatJid(f.threadJid))}]})}catch(a){c("FBLogger")("labyrinth_web").catching(a).mustfix("Failed to call bridge handler RefreshContact for JID %s and mediaType %s",f.threadJid,f.type)}return e;case"missing-receipt":case"wrong-message-state":case"unexpected-message-codepath":case"result-parsing-error":case"retryable-error":case"no-recipients":case"encryption-error":case"too-many-retries":return e;default:e.error.type;throw c("err")("Unreachable code")}}e.success;b.addPoint("wa_send_msg_end");((p=e.value.meta)==null?void 0:p.pOrDhashMismatch)&&(b.addPoint("dhash_phash_mismatch"),c("promiseDone")(d("MAWDebugMsg").writeDebugMsg(q.chat,"Outgoing msg "+q.externalId+" got a phash mismatch")));b.addPoint("mark_edit_msg_sent_start");g!=null?yield d("MAWMarkEditMsgSentApi").markEditMsgSent(q,g,e.value.serverTs,e.value.reportingMeta):yield d("MAWMarkMsgSentApi").markMsgSent(q,e.value.serverTs,e.value.reportingMeta);b.addPoint("mark_edit_msg_sent_end");b.addPoint("eb_upload_scheduling_start");yield c("EBAPI").uploadSentMessage({dbMsg:f,instanceKey:q.externalId,isXMAMsg:m,media:n,messageApplication:o,messageApplicationBytes:l.bytes,protocolMsgId:q,serverTs:e.value.serverTs,xmaPayload:a});b.addPoint("eb_upload_scheduling_end");return e});return o.apply(this,arguments)}function p(a,b,c){b.addAnnotations({bool:{is_secure:!0},string:{description:c,jid:a.protocolMsgId.chat}});return n(a,b)}e=d("MAWJobManager").getPersistedJobsApi().definePersistedJob().finalStep("encryptAndSend",{code:function(a){var b=a.s2sInstanceKey;a=babelHelpers.objectWithoutPropertiesLoose(a,["s2sInstanceKey"]);return p(a,d("WAQPLProxy").waQPLProxyStartResume(c("qpl")._(25313175,"1551"),b),"sendWrittenMsg")},stopRetryIf:{onStopRetry:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=a.protocolMsgId;d("MAWMessageSendsCommon").messageSendLogger.LOG(m(),a);var b=(yield d("MAWMarkMsgDroppedApi").markMsgDropped(a));d("MAWMessageSendsCommon").messageSendLogger.LOG(l(),a,b);return d("WAResultOrError").makeError({isRetriable:!0,type:"too-many-retries"})});function c(b){return a.apply(this,arguments)}return c}(),timePassedSeconds:a}}).end();g.sendWrittenMsgExternal=p;g.sendWrittenMsg=e}),98);
__d("getBroadcastChannelForExecutionContext",["CometTaskFrameworkTypes","MWBroadcastChannel"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return d("MWBroadcastChannel").MWBroadcastChannel(d("CometTaskFrameworkTypes").TASK_FRAMEWORK_PREFIX+"_"+String(a))}g["default"]=a}),98);
__d("getProtocolMsgIdByMsgIdCommon",["MAWDexieTable","WAJids"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){return d("MAWDexieTable").dexieAll([a.messages.get({msgId:b}),a.unrenderedMessages.get({msgId:b}),a.reactions.get({reactionId:b})]).then(function(b){var c=b[0],e=b[1];b=b[2];if(b!=null)if(d("WAJids").isAuthorSystem(b.author))return null;else return{author:b.author,chat:b.threadJid,externalId:b.externalId};var f=c||e;return f==null?null:a.threads.get({jid:f.threadJid}).then(function(a){if(a==null)return null;return d("WAJids").isAuthorSystem(f.author)?null:{author:f.author,chat:a.jid,externalId:f.externalId}})})}g.getProtocolMsgIdByMsgIdCommon=a}),98);
__d("loadTaskHandlerResource",["asyncToGeneratorRuntime","cr:3760"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=b("cr:3760").TASK_HANDLERS_RESOURCES[a];return a==null?null:a.getModuleIfRequired()||a.load()});return h.apply(this,arguments)}g["default"]=a}),98);